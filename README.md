# Robotic Arm Grasping Simulation

This project implements a simulation of a robotic arm grasping a small soft object with a non-smooth surface. The solution includes both basic grasping functionality and sensor-based object detection.

## Project Structure

```
robotic-arm-simulation/
├── main.py        # Main simulation code
├── videos/        # Generated demonstration videos
├── console log.txt # Console log of a simulation run
└── README.md      # This file
```

## Prerequisites

- Python 3.8 or higher
- PyBullet
- NumPy
- OpenCV

## Installation

1. Clone the repository (if applicable):

    ```bash
    git clone <repository_url>
    cd robotic-arm-simulation
    ```

2. Install the required dependencies:

    ```bash
    pip install pybullet numpy opencv-python
    ```

3. Ensure all required asset files (URDFs) are accessible by PyBullet. The code uses the data provided by the `pybullet_data` package, so ensure it is correctly installed.

## Usage

Run the simulation with:

```bash
python main.py
```

By default, the simulation attempts to run in GUI mode first. If GUI mode fails (due to environment limitations), it falls back to DIRECT (headless) mode. The simulation performs the following steps:

1. Initializes the PyBullet physics environment.
2. Loads the plane, table, and KUKA robotic arm.
3. Loads the gripper fingers and sets up constraints.
4. Loads the soft object (sphere or cube).
5. If sensor-based detection is enabled, it detects the object's position.
6. Moves the robotic arm to a home position.
7. Moves the arm to a position above the object.
8. Moves the arm to a grasping position.
9. "Closes" the gripper (functionality modified due to URDF limitations).
10. Lifts the object.
11. Moves the object to a new location.
12. Places the object.
13. "Opens" the gripper (functionality modified due to URDF limitations).
14. Moves back to the home position.
15. Records a video of the simulation.

## Key Features

- **Robotic Arm Control**: Simulates the movement and grasping actions of a KUKA robotic arm.
- **Soft Object Grasping**: Attempts to grasp a soft object (sphere or cube). The gripper functionality has been modified due to URDF issues.
- **Sensor-Based Object Detection**: Includes an optional sensor-based object detection mechanism (RGB-D camera simulation).
- **Video Recording**: Records a video of the simulation, even in headless mode.
- **Headless Mode Support**: Runs in headless mode (`p.DIRECT`) when GUI is not available.

## Important Notes

- **GUI Limitations**: The GUI mode may not function correctly in some environments, such as Replit, due to graphics driver issues. The simulation defaults to headless mode in such cases.
- **Gripper Functionality**: The gripper finger URDFs used in this simulation do not contain joints. The `open_gripper()` and `close_gripper()` functions have been modified to simply return without performing any actions.
- **Video Corruption**: Some video files generated by this simulation may be corrupted. This can be due to environment limitations or issues with the OpenCV video writer.
- **Camera Angle**: The camera angle can be adjusted in the `capture_frame()` method to improve the view of the grasping action.
- **Joint Index Errors**: If joint index errors occur, ensure that the correct joint indices are used for the gripper fingers. The joint indices can be printed to the console using the provided code.
- **Constraint Errors**: The `createConstraint` function had errors with the `jointLowerLimit` keyword argument. This was fixed by using the `changeConstraint` method with positional arguments.

## Console Log

The `console log.txt` file contains the console output of a simulation run in `p.DIRECT` mode. It provides information about the simulation's progress, including:

```
pybullet build time: Jan 29 2025 23:17:20
Loading plane.urdf...
Plane loaded successfully
Loading table.urdf...
Table loaded successfully, ID: 1
Available URDFs in PyBullet data path: /home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/pybullet_data
Looking for KUKA model in: /home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/pybullet_data
Successfully loaded KUKA arm, ID: 2
Joint index: 0, Joint name: lbr_iiwa_joint_1
Joint index: 1, Joint name: lbr_iiwa_joint_2
Joint index: 2, Joint name: lbr_iiwa_joint_3
Joint index: 3, Joint name: lbr_iiwa_joint_4
Joint index: 4, Joint name: lbr_iiwa_joint_5
Joint index: 5, Joint name: lbr_iiwa_joint_6
Joint index: 6, Joint name: lbr_iiwa_joint_7
Left finger joints:
Right finger joints:
Video will be saved to: videos/robotic_arm_simulation_20250302_105236.mp4
Connected to PyBullet in DIRECT (headless) mode
PyBullet version: 202010061
PyBullet data path: /home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/pybullet_data
Initializing simulation...
Simulation step 0/100...
Simulation step 20/100...
Simulation step 40/100...
Simulation step 60/100...
Simulation step 80/100...
Moving to home position...
Detecting object position...
Object detected at world coordinates: [0.951, -0.352, 1.120]
Object detected at: [0.9506939653904516, -0.35237384736669575, 1.1203470041211985]
Opening gripper...
Moving above object at: [0.9506939653904516, -0.35237384736669575, 1.2203470041211986]
Moving to grasping position: [0.9506939653904516, -0.35237384736669575, 1.1503470041211985]
Closing gripper to grasp object...
Lifting object to: [0.9506939653904516, -0.35237384736669575, 1.3203470041211984]
Moving object to new position: [0.7506939653904516, -0.25237384736669577, 1.3203470041211984]
Placing object at: [0.7506939653904516, -0.25237384736669577, 1.1503470041211985]
Opening gripper to release object...
Moving back to home position...
Grasping task completed successfully!
Simulation completed, keeping simulation running...
```

## Troubleshooting

- **GUI Issues**: If you encounter GUI issues, try running the simulation in `p.DIRECT` mode.
- **Joint Index Errors**: Verify the joint indices for the gripper fingers.
- **Video Corruption**: Ensure proper video writer closure and check frame data.
- **Object Detection**: If object detection fails, check the camera sensor setup and object placement.
- **Constraint Errors**: If you encounter constraint errors, ensure the correct use of the `changeConstraint` method.

## Author

Vyshnav K


